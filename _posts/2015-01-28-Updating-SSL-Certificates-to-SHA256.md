---
layout: post
title: Updating SSL certificates to SHA256
---
Recently, Google has [announced](http://googleonlinesecurity.blogspot.co.uk/2014/09/gradually-sunsetting-sha-1.html) that it is deprecating use of SSL certificates with a signature generated by the SHA1 algorithm in Chrome. These certificates (which make up a large percentage of those issued online) will be progressively de-trusted in Chrome, depending on their expiration date. For now, certificates will be marked as "secure, but with minor errors" but going forwards, they will be eventually marked as insecure.

The successor to SHA1 is SHA-256, and all new SSL certificates and certificates in the chain (intermediates - but not root certificates) will need to be using an SHA-256 signature in order to be trusted correctly in Chrome from now on.

This means making sure that all new certificates issued use SHA-256, and re-issuing old ones that expire after 31st December 2015.

The good news is it's simple to do in `openssl` (albeit time consuming if you have lots to do). It took at least an hour to do the dozen or so that I manage.

First, generate a 4096-bit long key (can be other lengths):
<pre>
openssl genrsa -out webserver.key 4096
</pre>

Then, create a CSR for your web server with the `-sha256` flag:
<pre>
openssl req -out webserver.csr -key webserver.key -new -sha256 -subj /CN=my.website.com
</pre>

Then, use the CSR to generate the certificate and sign it:
<pre>
openssl x509 -req -sha256 -in webserver.csr -out webserver.cer -CAkey intermediate.key -CA intermediate.cer -days 365 -CAcreateserial -CAserial serial -extfile server.cnf
</pre>

Again, make sure you pass the `-sha256` flag.

The `-extfile server.cnf` flag allows you to specify additional x509 extensions; I use it to attach the location to the CRL file to certificates. You can skip it if you don't need additional extensions.

That will generate a web server certificate and you'll then replace your current .cer and .key files with them. Inspecting the certificate should verify that it is using SHA-256.

Remember all intermediates in your SSL chain will need to be using SHA-256 as well. If you use certificates from a commercial CA then you will need to download their new intermediate bundle and install it. If you are using your own root and intermediate certificate (as I have previously blogged about) - then you'll need to create a new intermediate certificate and key signed by the root.